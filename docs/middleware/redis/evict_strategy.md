---
title: Evict
sidebar_position: 5
---


> docs: [redis key eviction policies](https://redis.io/docs/manual/eviction/#:~:text=Key%20eviction%20Overview%20of%20Redis%20key%20eviction%20policies,the%20default%20behavior%20for%20the%20popular%20memcached%20system.)




### 何为数据淘汰，Redis有了数据过期策略为什么还要有数据淘汰策略？

> 我先来回答第一个问题，Redis中数据淘汰实际上是指的在内存空间不足时，清理掉某些数据以节省内存空间。 虽然Redis已经有了过期的策略，它可以清理掉有效期外的数据。但想象下这个场景，如果过期的数据被清理之后存储空间还是不够怎么办？是不是还可以再删除掉一部分数据？ 在缓存这种场景下 这个问题的答案是可以，因为这个数据即便在Redis中找不到，也可以从被缓存的数据源中找到。所以在某些特定的业务场景下，我们是可以丢弃掉Redis中部分旧数据来给新数据腾出空间。





### 淘汰哪些数据，有什么样的数据选取标准？

第二个问题，既然我们需要有淘汰的机制，你们在具体执行时要选哪些数据淘汰掉？具体策略有很多种，但思路只有一个，那就是总价值最大化。我们生在一个不公平的世界里，同样数据也是，那么多数据里必然不是所有数据的价值都是一样的。所以我们在淘汰数据时只需要选择那些低价值的淘汰即可。

所以问题又来了，哪些数据是低价值的？这里不得不提到一个贯穿计算机学科的原理局部性原理，这里可以明确告诉你，局部性原理在缓存场景有这样两种现象：
    1. 最新的数据下次被访问的概率越高。 
    2. 被访问次数越多的数据下次被访问的概率越高。 这里我们可以简单认为被访问的概率越高价值越大。

基于上述两种现象，我们可以指定出两种策略：
    1. 淘汰掉最早未被访问的数据 LRU(Least Recently Used)。
    2. 淘汰掉访被访问频次最低的数据 LFU(Least Frequently Used)。


### Redis的数据淘汰策略是如何实现的？


> 首先我们需要明白一点，无论 eviction 为何，redis 过期的 key 都是会被清理的。

除了LRU和LFU之外，还可以随机淘汰。这就是将数据一视同仁，随机选取一部分淘汰。实际上Redis实现了以上3中策略，你使用时可以根据具体的数据配置某个淘汰策略。除了上述三种策略外，Redis还为由过期时间的数据提供了按TTL淘汰的策略，其实就是淘汰剩余TTL中最小的数据。另外需要注意的是Redis的淘汰策略可以配置在全局或者是有过期时间的数据上，所以Redis共计以下8中配置策略。



![redis-key-eviction](/images/redis-key-eviction.jpg)